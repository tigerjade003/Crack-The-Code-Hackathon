import sqlite3
from encryption import gethash
import os.path

database = sqlite3.connect("password.db")
cur = database.cursor()
cur.execute("CREATE TABLE IF NOT EXISTS user(hash, hexhash)")
works = False
counter = 0
def start():
    if(os.path.isfile("passwords.txt")):
        cur.execute("DELETE FROM user")
        cur.execute("CREATE TABLE IF NOT EXISTS user(hash, hexhash)")
        f = open("passwords.txt", "r")
        Lines = f.readlines()
        for a in Lines:
            e = a.split()
            for k in e:
                k.strip()
            cur.execute("INSERT INTO user VALUES (?, ?)", e)

    global counter
    global works
    works = False
    counter = 0
def create():
    username = input("Please Enter Your UserName: ")
    password = input("Please Enter Your Password: ")
    e = gethash(username, password)
    params = (e.a, e.b)
    cur.execute("INSERT INTO user VALUES (?, ?)", params)
    global works
    if not works:
        works = True
        start()
    global counter
    counter += 1

def check(hash1, hash2):
    try:
        cur.execute("SELECT * FROM user WHERE hash = ? AND hexhash = ?", (hash1, hash2))
        row2 = cur.fetchall()
        if len(row2) >= 1:
            return True
        return False
    except Exception as e:
        print("Error:", e)
        return False

